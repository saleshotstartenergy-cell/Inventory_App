{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <a href="{{ url_for('stock_summary') }}" class="btn btn-outline-secondary btn-sm">â¬… Back</a>
  <h3 class="fw-bold mb-0">Stock Items - {{ brand }}</h3>

  <form method="get" class="mb-3 d-flex align-items-center">
    <input type="text" name="q" class="form-control form-control-sm mr-2"
           placeholder="Search item or brand..."
           value="{{ request.args.get('q', '') }}">
    <button type="submit" class="btn btn-primary btn-sm">Search</button>
  </form>
</div>

<div class="table-responsive shadow-sm rounded bg-white p-3">
  <table class="table table-hover table-bordered align-middle mb-0">
    <thead class="table-dark">
      <tr>
        <th>Item</th>
        <th>Total Qty</th>
        <th>Reserved</th>
        <th>Available</th>
        <th>Reserved By</th>
        <th>Reserve Until</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for i in items %}
      <tr>
        <td>{{ i.item }}</td>
        <td>{{ i.total_qty }}</td>
        <td>{{ i.reserved_qty }}</td>

        <!-- Available qty logic -->
        <td>
          {% if i.available_qty <= 0 %}
            <span class="badge bg-danger">Out</span>
          {% else %}
            {{ i.available_qty }}
          {% endif %}
        </td>

        <td>{{ i.reserved_by or '-' }}</td>
        <td>{{ i.end_date or '-' }}</td>

        <td>
          {% if i.available_qty > 0 %}
          <form method="POST" class="d-flex align-items-center flex-wrap gap-2">
            <input type="hidden" name="item" value="{{ i.item }}">
            
            <!-- Qty -->
            <input type="number" name="qty" min="1" max="{{ i.available_qty }}"
                   class="form-control form-control-sm mr-2" style="width:80px;" required>
            
            <!-- Reserved By -->
            <input type="text" name="reserved_by"
                   class="form-control form-control-sm mr-2"
                   placeholder="Name" style="width:130px;" required>

            <!-- End Date -->
            <input type="date" name="end_date"
                   class="form-control form-control-sm mr-2"
                   required
                   min="{{ today.strftime('%Y-%m-%d') }}"
                   max="{{ (today + timedelta(days=3)).strftime('%Y-%m-%d') }}">

            <button type="submit" class="btn btn-sm btn-primary">Reserve</button>
          </form>
          {% else %}
            <span class="text-muted">Fully Reserved</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
